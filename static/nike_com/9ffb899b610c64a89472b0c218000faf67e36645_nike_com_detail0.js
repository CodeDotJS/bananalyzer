!function(){"use strict";for(var t,e=256,r=[];e--;)r[e]=(e+256).toString(16).substring(1);function n(){var n,o=0,i="";if(!t||e+16>256){for(t=Array(o=256);o--;)t[o]=256*Math.random()|0;o=e=0}for(;o<16;o++)n=t[e+o],i+=6==o?r[15&n|64]:8==o?r[63&n|128]:r[n],1&o&&o>1&&o<11&&(i+="-");return e++,i}const o={PIXEL:"pixel",WEB:"web"},i={PI:"PAGE_INIT",PC:"PAGE_CART",PCH:"PAGE_CHECKOUT",PF:"PAGE_FINALIZATION",PH:"PAGE_HOME",PL:"PAGE_LANDING",PP:"PAGE_PAYMENT",PPR:"PAGE_PRODUCT",PR:"PAGE_RETURN",PS:"PAGE_SHIPPING"},{PC:c,PCH:u,PF:a,PP:d,PPR:s,PR:m,PS:g}=i,p={[c]:{requiredFields:["products"]},[u]:{requiredFields:["products"]},[a]:{requiredFields:["products","transaction.id","transaction.subTotal"]},[d]:{requiredFields:["transaction"]},[s]:{requiredFields:["products"]},[m]:{requiredFields:["transaction.id","transaction.originalId"]},[g]:{requiredFields:["products"]}},{PIXEL:l}=o,P={getBeaconUrl:(t=l)=>`https://gateway.captiv8.io/api/v2/attribution/${t}`},{getBeaconUrl:f}=P,C=t=>{const e=new Date,r=t/60||24;return e.setTime(e.getTime()+60*r*60*1e3),`expires=${e.toUTCString()}`},w=(t,e)=>{const r=new Blob([JSON.stringify(t)]),n=f(e);navigator.sendBeacon(n,r)},S=(t,e,r)=>{const n=`${t}=${e}; ${r}; path=/`;document.cookie=n},T=t=>{const e=`${t}=`,r=decodeURIComponent(document.cookie).split(";");for(let t=0;t<r.length;t+=1){let n=r[t];for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return""},I=t=>{document.cookie=`${t}=;expires=${new Date(0).toUTCString()}`};var h="1.2.0";const{WEB:_}=o,{PI:E}=i,A=({now:t,utmSource:e,utmMedium:r,utmCampaign:o,utmTerm:i,utmContent:c})=>{try{const u=new URLSearchParams(window.location.search),a=u.get("c8cid"),d=u.get("c8px");if(a){const n=a.split("-");if(2===n.length){const[u,d]=n;((t,e)=>{const r=C(t);S("c8cid",e,r)})(d,a),I("c8pxid");const s={page:E,version:h,date:t.toISOString(),c8cid:a,utmSource:e,utmMedium:r,utmCampaign:o,utmTerm:i,utmContent:c,pageInfo:{referrer:document.referrer,url:document.URL}};return void w(s,_)}}if(d){const u=n(),a=d.split("-");if(4===a.length){const[s,m,g]=a;((t,e)=>{const r=C(t);S("c8sid",e,r)})(g,u),((t,e)=>{const r=C(t);S("c8pxid",e,r)})(g,d);const p=T("c8uid")||n(),l=!T("c8uid");(t=>{const e=C(525600);S("c8uid",t,e)})(p),I("c8cid");const P={page:E,version:h,date:t.toISOString(),pxid:d,sid:u,uid:p,newSession:l,utmSource:e,utmMedium:r,utmCampaign:o,utmTerm:i,utmContent:c,pageInfo:{referrer:document.referrer,url:document.URL}};w(P)}}}catch(t){console.error(t)}},R=t=>{const{pageType:e,page:r,...n}=t,o=e||r;if(!o)return void console.error("[C8 Pixel] No page type provided",{data:t});const{requiredFields:i}=p[o]||{};i?.length&&i.forEach((e=>{void 0===((t,e)=>{const r=e.split(".");try{return r.reduce(((t,e)=>t?.[e]||t?.[e.replace(/\B([A-Z])/g,"_$1").toLowerCase()]),t)}catch(t){return}})(n,e)&&console.error(`[C8 Pixel] Missing required field: ${e}`,{data:t})}))},{WEB:v}=o,{WEB:y}=o,{PF:U}=i;try{const t=new URLSearchParams(window.location.search),e=new Date,r=t.get("utm_source"),n=t.get("utm_medium"),o=t.get("utm_campaign"),i=t.get("utm_term"),c={now:e,utmSource:r,utmMedium:n,utmCampaign:o,utmTerm:i,utmContent:t.get("utm_content")},u=Object.keys(c).filter((t=>c[t])).reduce(((t,e)=>({...t,[e]:c[e]})),{});A(u),(({now:t,utmSource:e,utmMedium:r,utmCampaign:n,utmTerm:o,utmContent:i})=>{try{const c=T("c8cid");if(c){const{pageType:u,page:a,products:d,transaction:s,c8aid:m,is_debug:g}=window.c8data;R(window.c8data);const p={page:u||a,products:d,transaction:s,version:h,date:t.toISOString(),c8aid:m||"",c8cid:c,utmSource:e,utmMedium:r,utmCampaign:n,utmTerm:o,utmContent:i,is_debug:g,pageInfo:{referrer:document.referrer,url:document.URL}};w(p,v)}}catch(t){console.error(t)}})(u),(({now:t,utmSource:e,utmMedium:r,utmCampaign:n,utmTerm:o,utmContent:i})=>{try{const c=T("c8sid"),u=T("c8uid"),a=T("c8pxid");if(c&&u&&a){const{pageType:d,page:s,products:m,transaction:g,is_debug:p}=window.c8data;R(window.c8data);const l={page:d||s,products:m,transaction:g,version:h,date:t.toISOString(),sid:c,uid:u,pxid:a,utmSource:e,utmMedium:r,utmCampaign:n,utmTerm:o,utmContent:i,is_debug:p,pageInfo:{referrer:document.referrer,url:document.URL}};w(l)}}catch(t){console.error(t)}})(u),(({now:t,utmSource:e,utmMedium:r,utmCampaign:n,utmTerm:o,utmContent:i})=>{try{const c=T("c8cid"),{c8aid:u,transaction:a,pageType:d,page:s,products:m,is_debug:g}=window.c8data;if(!c&&u&&(d||s)===U&&a?.coupons?.length>0){R(window.c8data);const c={page:U,c8aid:u,products:m,transaction:a,version:h,date:t.toISOString(),c8cid:"",utmSource:e,utmMedium:r,utmCampaign:n,utmTerm:o,utmContent:i,is_debug:g,pageInfo:{referrer:document.referrer,url:document.URL}};w(c,y)}}catch(t){console.error(t)}})(u)}catch(t){console.error(t)}}();
